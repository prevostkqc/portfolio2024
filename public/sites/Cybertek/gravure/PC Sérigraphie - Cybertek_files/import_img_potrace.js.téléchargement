window.onload=function(){var imageInputSelect=document.getElementById("imageInput_img");imageInputSelect.addEventListener("click",function(e){},false);var imageSelect=document.getElementById("imageSelect"),imageInput=document.getElementById("imageInput");imageSelect.addEventListener("click",function(e){imageInput.click();e.preventDefault();},false);imageInput.addEventListener("change",function(e){handleFiles(this.files);},false);var drop=document.getElementById('drop');drop.addEventListener("dragenter",function(e){if(e.preventDefault)e.preventDefault();e.dataTransfer.dropEffect='copy';this.classList.add('hovering');return false;},false);drop.addEventListener("dragleave",function(e){if(e.preventDefault)e.preventDefault();e.dataTransfer.dropEffect='copy';this.classList.remove('hovering');return false;},false);drop.addEventListener("dragover",function(e){if(e.preventDefault)e.preventDefault();e.dataTransfer.dropEffect='copy';this.classList.add('hovering');return false;},false);drop.addEventListener("drop",function(e){if(e.preventDefault)e.preventDefault();this.classList.remove('hovering');handleFiles(e.dataTransfer.files);return false;},false);};function handleFiles(files){Potrace.loadImageFromFile(files[0]);Potrace.process(function(){displayImg();displaySVG(1);});}
function displayImg(){var imgdiv=document.getElementById('imgdiv');imgdiv.style.display='block !important';imgdiv.style.padding='20px !important';imgdiv.appendChild(Potrace.img);}
function displaySVG(size,type){$('#svg').css('width','200px');$('#svg').css('height','200px');$('#logo_modulable').css('width','200px');$('#logo_modulable').css('height','200px');$('#patch_svg').css('width','200px');$('#patch_svg').css('height','200px');$('#logo_modulable ').removeClass('hideSuper');if(prevReadyLogo==0){prevReady=prevReady+10;prevReadyLogo=10;}
testReady();$('#logo_modulable').removeClass("logo_modulable");$('#logo_modulable').addClass("logo_modulable_svg");$('#img_render--img').css("display","none");$('#path_svg').css("transform","scale(1)");$('#img_render').css("height","auto");$('#img_render').css("width","100%");$('#svg').css("height","fit-content");$('#svg').css("width","100%");var img_render=document.getElementById('img_render');var img_render_img=document.getElementById('img_render--img');img_render_img.src="";img_render.innerHTML=Potrace.getSVGperso(size,type);var width=document.getElementById('img_render--img').offsetWidth;var x=parseInt($('#svg').attr('width'));var y=parseInt($('#svg').attr('height'));var height=(width/x)*y;$('#svg').css('height',height);$('#img_render ').css("height","fit-content");var contentImage=document.getElementById("imgdiv").getElementsByTagName("img")[0];var img_naturalHeight=contentImage.naturalHeight;var img_naturalWidth=contentImage.naturalWidth;var zone_logos=document.getElementById("logo_container");var logo_container_naturalWidth=zone_logos.clientWidth;var logo_container_naturalHeight=zone_logos.clientHeight;let tailleTotaleWidth=img_naturalWidth.toFixed(0);let tailleTotaleHeight=img_naturalHeight.toFixed(0);tailleTotaleWidth=parseInt(tailleTotaleWidth);tailleTotaleHeight=parseInt(tailleTotaleHeight);var categorieTailleImage="";var lePath=document.getElementById("path_svg");var widthPath=lePath.getBoundingClientRect().width;var heightPath=lePath.getBoundingClientRect().height;widthPath=widthPath*2.90;$('.gravure_alerte').addClass('gravure_alerte--hidden');var ratio_image=0;var ratioWidthSVG=1;var tailleM=0;var tailleF=0;var typeFormat="0";var texteScale="0.1";if(tailleTotaleWidth==tailleTotaleHeight){typeFormat="A";categorieTailleImage="H = W";$('.gravure_alerte').removeClass('gravure_alerte--hidden');ratioWidthSVG=logo_container_naturalWidth/widthPath;if(ratioWidthSVG>=0.10&&ratioWidthSVG<=0.11){ratioWidthSVG=0.1}else{if(ratioWidthSVG>0.11&&ratioWidthSVG<0.2){ratioWidthSVG=0.12;}}
texteScale=ratioWidthSVG+"";tailleM=tailleTotaleWidth;tailleF=tailleTotaleHeight;console.log(typeFormat);image_export(texteScale);}
else{categorieTailleImage="H != W";var ratio_imageH=img_naturalHeight/517;var ratio_imageW=img_naturalWidth/576;ratio_total=ratio_imageW-ratio_imageH;if(ratio_total<=0.015&&ratio_total>0.0){typeFormat="RATIO PERFECT";}
if(typeFormat=="RATIO PERFECT"){if(img_naturalWidth==logo_container_naturalWidth){categorieTailleImage="H = zH";typeFormat="PERFECT";texteScale=0.1;image_export(texteScale);}
else{typeFormat="RATIO PERFECT";categorieTailleImage="ratio ok";ratioHeightSVG=(heightPath/logo_container_naturalHeight)/100;texteScale=ratioHeightSVG+"";if(tailleTotaleWidth==1440){ratioHeightSVG=tailleTotaleHeight/517;ratioHim=tailleTotaleHeight/tailleTotaleWidth;var sizeHeightY=ratioHim*0.466;ratioHim=ratioHim/sizeHeightY;ratioHim=sizeHeightY;ratioHim=ratioHim/10;texteScale=ratioHim+"";}else{ratioHim=tailleTotaleHeight/tailleTotaleWidth;ratioWidthSVG=logo_container_naturalWidth/widthPath;ratioWidthSVG=ratioWidthSVG*0.80;if(tailleTotaleWidth>=logo_container_naturalWidth){ratioHim=tailleTotaleHeight/tailleTotaleWidth;ratioWidthSVG=logo_container_naturalWidth/widthPath;ratioWidthSVG=ratioWidthSVG*0.80;if(tailleTotaleWidth>=1000){if(tailleTotaleWidth>=1500){widthPath=widthPath*1.05;}else{widthPath=widthPath*1.2;}}else{widthPath=widthPath*1.02;}}else{widthPath=widthPath*1.02;}
texteScale=ratioWidthSVG+"";}
tailleM=tailleTotaleWidth/ratio_image;tailleF=tailleTotaleHeight/ratio_image;image_export(texteScale);}}
else{if(tailleTotaleWidth<=logo_container_naturalWidth){if(tailleTotaleHeight>=logo_container_naturalHeight){categorieTailleImage="H > zH";typeFormat="Z";ratioHeightSVG=(heightPath/logo_container_naturalHeight)/100;texteScale=ratioHeightSVG+"";ratioHeightSVG=tailleTotaleHeight/517;ratioHim=tailleTotaleHeight/tailleTotaleWidth;var sizeHeightY=ratioHeightSVG*0.85;ratioHim=ratioHim/sizeHeightY;ratioHim=ratioHim/10;texteScale=ratioHim+"";tailleM=tailleTotaleWidth/ratioHeightSVG;tailleF=tailleTotaleHeight;image_export(texteScale);}else{categorieTailleImage="W < zW";typeFormat="B";ratioWidthSVG=logo_container_naturalWidth/widthPath;texteScale=ratioWidthSVG+"";tailleM=tailleTotaleWidth;tailleF=tailleTotaleHeight;image_export(texteScale);}}else{if(img_naturalWidth>=logo_container_naturalWidth){if(tailleTotaleHeight>tailleTotaleWidth){if(tailleTotaleHeight>=logo_container_naturalHeight){categorieTailleImage="H > zH";typeFormat="Y";ratioHeightSVG=(heightPath/logo_container_naturalHeight)/100;texteScale=ratioHeightSVG+"";ratioHeightSVG=tailleTotaleHeight/517;ratioHim=tailleTotaleHeight/tailleTotaleWidth;var sizeHeightY=ratioHeightSVG*0.88;ratioHim=ratioHim/sizeHeightY;ratioHim=ratioHim/10;texteScale=ratioHim+"";tailleM=tailleTotaleWidth/ratioHeightSVG;tailleF=tailleTotaleHeight;image_export(texteScale);}}else{categorieTailleImage="W < zW";typeFormat="C";ratioWidthSVG=logo_container_naturalWidth/widthPath;ratio_image=tailleTotaleWidth/logo_container_naturalWidth;var ratio_image_final=(tailleTotaleWidth/tailleTotaleHeight)*2;ratio_image_final=ratio_image_final/100;if(tailleTotaleWidth>1000&&tailleTotaleWidth<1500){if(ratio_image_final>=0.0300&&ratio_image_final<=0.0360){typeFormat="D";ratioWidthSVG=0.05;}else{typeFormat="E";if(tailleTotaleWidth>2000){ratioWidthSVG=0.4;}else{ratioWidthSVG=0.1;}}}else{if(tailleTotaleWidth>1500){if(ratio_image_final>=0.0300&&ratio_image_final<=0.0360){typeFormat="F";ratioWidthSVG=0.035;}}else{typeFormat="G";if(ratioWidthSVG<0.1){ratioWidthSVG=ratioWidthSVG;}else{ratioWidthSVG=ratioWidthSVG/2.3;}}}
texteScale=ratioWidthSVG+"";tailleM=tailleTotaleWidth/ratioWidthSVG;tailleF=tailleTotaleHeight;if(tailleTotaleHeight>logo_container_naturalWidth){tailleF=tailleTotaleHeight/ratio_image;}
if(typeFormat=="C"||typeFormat=="G"){tailleF=tailleTotaleHeight/ratio_image;}
image_export(texteScale)}}else{if(img_naturalHeight<=logo_container_naturalHeight){typeFormat="X";}}}}}
$('#img_render').removeClass('opacity_previsualiser');$('#img_render').addClass("forced_visibility");$('#logo_modulable ').show();$('.logo').show();function image_export(texteScale){$('#img_render').removeClass('opacity_previsualiser');$('#img_render').addClass("forced_visibility");$('#img_render--img').attr('src','../images/pc-serigraphie/frame.png');ratioScalePermanent=parseFloat(texteScale);texteScale="scale("+texteScale+")";$('#logo_modulable').css("transform","rotate(0.0)");$('#logo_modulable').css("top","0px");$('#logo_modulable').css("left","0px");$('#img_render ').css("display","block");$('#svg').css("width","100% !important");if(typeFormat=="PERFECT"||typeFormat=="RATIO PERFECT"){if(typeFormat=="PERFECT"){$('#path_svg').css("transform","scale(0.1)");}else{$('#path_svg').css("transform",texteScale);}
$('#logo_modulable').css("width","576px");$('#logo_modulable').css("height","517px");}else{$('#logo_modulable').css("width","100%");$('#path_svg').css("transform",texteScale);if(categorieTailleImage=="H = W"){$('#logo_modulable').css("width","515px");$('#logo_modulable').css("height","515px");}else{$('#logo_modulable').css("width",tailleM);$('#logo_modulable').css("height",tailleF);}}}}