$(document).ready(function(){const VITREWIDTH=576;const VITREHEIGHT=620;let vitreWidth=VITREWIDTH;let vitreHeight=VITREHEIGHT;let largeurBoitier=41;let hauteurBoitier=35;let valueRapport=0;if(largeurBoitier>hauteurBoitier){valueRapport=largeurBoitier/hauteurBoitier;valueRapport=valueRapport.toFixed(1);vitreHeight=vitreHeight/valueRapport;vitreHeight=vitreHeight.toFixed(0);}else{valueRapport=hauteurBoitier/largeurBoitier;valueRapport=valueRapport.toFixed(1);vitreWidth=vitreWidth/valueRapport;vitreWidth=vitreWidth.toFixed(0);}
vitreWidth=parseInt(vitreWidth);vitreHeight=parseInt(vitreHeight);$('#logo_modulable ').addClass("hideSuper");$('.btn_modifier').addClass('btn_hidden');$('.btn_previsualiser').click(function(){$('.liste_config').addClass('btn_hidden');$('#drop').addClass('btn_hidden');$('#fakevalid').addClass('btn_hidden');$("#valider_visuel").prop("checked",false);if($('#importer_perso').is(':checked')){$('#submitConfigurator').removeClass('btn_hidden');$('#submitSvg').addClass('btn_hidden');}else{$('#submitConfigurator').addClass('btn_hidden');$('#submitSvg').removeClass('btn_hidden');}
modifierPrevisualiser();})
$('.btn_modifier').click(function(){$('#drop').removeClass('btn_hidden');$('.liste_config').removeClass('btn_hidden');$('#fakevalid').removeClass('btn_hidden');$('#submitConfigurator').addClass('btn_hidden');$('#submitSvg').addClass('btn_hidden');$("#valider_visuel").prop("checked",false);$(".valider_envoyer_show").addClass('valider_envoyer');$(".valider_envoyer_show_svg").addClass('valider_envoyer');modifierPrevisualiser();})
function modifierPrevisualiser(){$('.logos').toggleClass('logos--previsualiser');$('.logo').toggleClass('logo--previsualiser');$('.logo').toggleClass('opacity_previsualiser');$('.ui-rotatable-handle').toggleClass('icon--previsualiser');$('.ui-resizable-handle').toggleClass('icon--previsualiser');$('.pc_serigraphie_refresh').toggleClass('icon--previsualiser');$('.pc_serigraphie_refresh_text').toggleClass('icon--previsualiser');$('.zone_editable').toggleClass('zone_editable--affiche');$('.bloquer_choix_previsualiser').toggleClass('bloquer_choix_previsualiser_hide');$('.btn_modifier').toggleClass('btn_hidden');$('.btn_previsualiser').toggleClass('btn_hidden');$('.computer-text').toggleClass('opacity_previsualiser');$('.computer-text').toggleClass('texte--previsualiser');$('.computer-text-inner').toggleClass('opacity_previsualiser');$('.img_render').toggleClass('opacity_previsualiser');$('.hide_modifications').toggleClass('show_modifications');}
$('.text_small').click(function(){$(".computer-text-inner").css("fontSize","18px");$(".text_small").addClass('text_size--item--selected');$(".text_medium").removeClass('text_size--item--selected');$(".text_large").removeClass('text_size--item--selected');})
$('.text_medium').click(function(){$(".computer-text-inner").css("fontSize","25px");$(".text_medium").addClass('text_size--item--selected');$(".text_small").removeClass('text_size--item--selected');$(".text_large").removeClass('text_size--item--selected');})
$('.text_large').click(function(){$(".computer-text-inner").css("fontSize","32px");$(".text_large").addClass('text_size--item--selected');$(".text_small").removeClass('text_size--item--selected');$(".text_medium").removeClass('text_size--item--selected');})
let vitreWidthCenter=vitreWidth;let vitreHeightCenter=vitreHeight;$('.logos').width(vitreWidth);$('.logos').height(vitreHeight);$('#logo_container').width(vitreWidth);$('#logo_container').height(vitreHeight);vitreWidthCenter=vitreWidth+52;vitreHeightCenter=vitreHeight+4;$('.computer_mak').width(vitreWidthCenter);$('.computer_mak').height(vitreHeightCenter);$('.hide_modifications').click(function(){if($('#valider_visuel').is(':checked')){if($('#importer_perso').is(':checked')){$(".valider_envoyer_show").removeClass('valider_envoyer');$(".valider_envoyer_show_svg").addClass('valider_envoyer');}else{$(".valider_envoyer_show").addClass('valider_envoyer');$(".valider_envoyer_show_svg").removeClass('valider_envoyer');}}else{$(".valider_envoyer_show").addClass('valider_envoyer');$(".valider_envoyer_show_svg").addClass('valider_envoyer');}})
$(".step__choice").click(function(){if(prevReadyLogo==0){prevReady=prevReady+10;prevReadyLogo=10;}
$('.gravure_alerte').addClass('gravure_alerte--hidden');testReady();$('#img_render--img').attr('src',"");$('#logo_modulable ').removeClass('hideSuper');$('#img_render').hide();$('#img_render').removeClass("forced_visibility");$('#img_render--img').show();let choiceId="logo-1";let imgLogo=$(this).find('img');let urlimg=imgLogo.attr('src');$(".step__choice").removeClass('active');$(this).addClass('active');$('.logo').hide();$('.logo').removeAttr("style");let $imageLogo=$('.logo[data-id='+choiceId+']');$imageLogo.show();$(this).addClass('active');let logoModifiable=$('.logo');logoModifiable.find('img').attr('src',urlimg);});$(".pc_serigraphie_refresh").click(function(){if(prevReadyLogo==10){prevReady=prevReady-10;prevReadyLogo=0;}
testReady();$('.gravure_alerte').addClass('gravure_alerte--hidden');$('#img_render--img').attr('src',"../Images/pc-serigraphie/logos/pixel.png");$('#logo_modulable ').addClass('hideSuper');$('#img_render').removeClass("forced_visibility");$('#img_render--img').show();});$(".pc_serigraphie_refresh_text").click(function(){if(prevReadyText==1){prevReady=prevReady-1;prevReadyText=0;}
testReady();$('.champ_texte').val("");$('.computer-text-inner').text("");$('.computer-text').hide();});$('.step__input input').on('input',function(){if(prevReadyText==0){prevReady=prevReady+1;prevReadyText=1;}
testReady();let text=$(this).val();let textLength=text.length;if(textLength==0){if(prevReadyText==1){prevReady=prevReady-1;prevReadyText=0;}
testReady();$(".step_text-vide").removeClass('step_text-plain');$('.computer-text-inner').text("");$('.computer-text').hide();}else{if(prevReadyText==0){prevReady=prevReady+1;prevReadyText=1;}
testReady();$(".step_text-vide").addClass('step_text-plain');$('.computer-text-inner').text(text);$('.computer-text').show();}});$("#typo").change(function(){let $computerText=$('.computer-text-inner');$computerText.removeClass();$computerText.addClass('computer-text-inner');$computerText.addClass($(this).val());});$(".logo").draggable({containment:"parent",drag:function(){mouvementImage();},stop:function(ev,ui){$(".logo_center_top").removeClass("target-x");$(".logos_center_top").removeClass("target-x");$(".logo_center_left").removeClass("target-y");$(".logos_center_left").removeClass("target-y");}});$('.logo').rotatable().resizable({aspectRatio:true,containment:"parent",minWidth:140});$(".computer-text").draggable({containment:"parent",drag:function(){$(".computer-text").addClass('dragged');mouvementTexte();},stop:function(ev,ui){$(".text_center_top").removeClass("target-x");$(".logos_center_top").removeClass("target-x");$(".text_center_left").removeClass("target-y");$(".logos_center_left").removeClass("target-y");}});$('.computer-text').rotatable().resizable({containment:"parent",minWidth:140,});$("#submitConfigurator").click(function(e){$('#zone_logos').addClass("zone_logos--export");$('#img_render ').css("display","block");e.preventDefault();$('.content_wait_export').addClass('content_wait_export--view');$('.computer-text-inner').addClass('computer-text-export');$('.computer').addClass('btn_hidden');$('.computer_mak').addClass('btn_hidden');$('.logos').addClass('logos_export');$('.computer-wrapper').addClass('computer_export');$('.logo').addClass('computer_export');$('.computer-text').addClass('computer_export');vitreWidth=vitreWidth+5;$('.logos').width(vitreWidth);$('.logos').css("position","absolute");$('.logos').css("left","6px");$('.logos').css("top","1px");$('.computer-wrapper').width(vitreWidth).height(vitreHeight);$('.computer').css("display","none");$('.logos img').css('filter','brightness(0)');$('.logos img').css('opacity','1');$('.computer-text-inner').css('filter','brightness(0)');$('.computer-text-inner').css('opacity','1');function filter(node){let excludedClasses=['ui-rotatable-handle','ui-resizable-handle','computer-img'];let nodeClasse=node.className;return!(typeof nodeClasse!=="undefined"&&excludedClasses.some(function(v){return nodeClasse.indexOf(v)>=0;}));}
let imageExport=document.getElementById('configuratorCanvas');domtoimage.toJpeg(imageExport,{filter:filter,width:imageExport.clientWidth*2,height:imageExport.clientHeight*2,style:{transform:'scale(2)',transformOrigin:'top left',backgroundColor:'white',}}).then(function(dataUrl){var img=new Image();img.src=dataUrl;Potrace.loadImageFromUrl(dataUrl);Potrace.process(function(){saveSVG(1);});$(".logos--previsualiser").css('overflow',"initial !important");$('.logos img').css('filter','brightness(1)');$('.logos img').css('opacity','1');$('.computer-text-inner').css('color','white');$('.computer-text-inner').css('opacity','1');$('.computer-text-inner').css('filter','brightness(1)');$('.wait_export_alert_line1').addClass('wait_export_after_line1');$('.wait_export_alert_line2').addClass('wait_export_after_line2');$('#configuratorCanvas').addClass('content_wait_export');$('.wait_export').addClass('content_wait_export');});});$("#submitSvg").click(function(e){laststep();$('#img_render ').css("display","block");$('#zone_logos').addClass("zone_logos--export");var element=document.getElementById("zone_import");while(element.firstChild){element.removeChild(element.firstChild);}
e.preventDefault();$('.content_wait_export').addClass('content_wait_export--view');$('.computer-text-inner').addClass('computer-text-export');$('.computer').addClass('btn_hidden');$('.computer_mak').addClass('btn_hidden');$('.logos').addClass('logos_export');$('.computer-wrapper').addClass('computer_export');$('.logo').addClass('computer_export');$('.computer-text').addClass('computer_export');vitreWidth=vitreWidth+5;vitreWidth=vitreWidth+5;$('.logos').width(vitreWidth);$('.logos').css("position","absolute");$('.logos').css("left","6px");$('.logos').css("top","1px");$('.computer').css("display","none");$('.logos').css('filter','brightness(0)');$('.logos').css('opacity','1');$('.computer-text-inner').css('filter','brightness(0)');$('.computer-text-inner').css('opacity','1');let logoContainer=document.getElementById('zone_logos');let imageExport=document.getElementById('configuratorCanvas');$('#configuratorCanvas').css('max-height','brightness(1)');let logoContainerWidth=logoContainer.clientWidth;let logoContainerHeight=logoContainer.clientHeight;$('#configuratorCanvas').css('height','brightness(1)');$('#imageExport').css('width',logoContainerWidth);$('#imageExport').css('height',logoContainerHeight);$('.gravure_alerte').addClass('gravure_alerte--hidden');$('.gravure_alerte').removeClass('valider_visuel_format');domtoimage.toJpeg(imageExport,{width:logoContainerWidth*4,height:logoContainerHeight*4,style:{transform:'scale(4)',transformOrigin:'top left',backgroundColor:'white',}}).then(function(dataUrl){var imgo=new Image();imgo.src=dataUrl;Potrace.loadImageFromUrl(dataUrl);Potrace.process(function(){saveSVG(1);});$('.logos').css('filter','brightness(1)');$('.logos').css('opacity','0.7');$('.computer-text-inner').css('color','white');$('.computer-text-inner').css('opacity','0.7');$('.computer-text-inner').css('filter','brightness(1)');$('.wait_export_alert_line1').addClass('wait_export_after_line1');$('.wait_export_alert_line2').addClass('wait_export_after_line2');$('#configuratorCanvas').addClass('content_wait_export');$('.wait_export').addClass('content_wait_export');});});function saveSVG(size,type){let svg=Potrace.getSVG(size,type);if(telechargementDirect==1){var svgBlob=new Blob([svg],{type:"image/svg+xml;charset=utf-8"});var svgUrl=URL.createObjectURL(svgBlob);var downloadLink=document.createElement("a");downloadLink.href=svgUrl;downloadLink.download="gravure.svg";document.body.appendChild(downloadLink);downloadLink.click();document.body.removeChild(downloadLink);}else{$.ajax({type:'POST',url:'/boutique/pc-serigraphie.aspx/enregistrer',data:JSON.stringify({'svg':svg,'sessionId':$('#HiddenFieldSessionId').val(),'boitier':$('#DropDownListProduit').val(),'serviceId':$('#DropDownListService').val()}),dataType:'json',contentType:"application/json; charset=utf-8",processData:false,success:function(){window.close();document.location.href="/boutique/panier.aspx";},error:function(){alert("Une erreur s'est produite.");}});}
$('.computer').removeClass('btn_hidden');$('.logos').removeClass('logos_export');}
function mouvementImage(){$(".logo").each(function(){let moveposxlogo=$(".logo_center_top").offset().top;let moveposylogo=$(".logo_center_left").offset().left;let moveposxlogos=$(".logos_center_top").offset().top;let moveposylogos=$(".logos_center_left").offset().left;let returnvaleury=moveposylogos-moveposylogo;if(returnvaleury<=20&&returnvaleury>=-20){$(".logo_center_left").addClass("target-y");$(".logos_center_left").addClass("target-y");}else{$(".logo_center_left").removeClass("target-y");$(".logos_center_left").removeClass("target-y");}
let returnvaleurx=moveposxlogos-moveposxlogo;if(returnvaleurx<=20&&returnvaleurx>=-20){$(".logo_center_top").addClass("target-x");$(".logos_center_top").addClass("target-x");}else{$(".logo_center_top").removeClass("target-x");$(".logos_center_top").removeClass("target-x");}});}
function getRotationDegrees(obj){var matrix=obj.css("-webkit-transform")||obj.css("-moz-transform")||obj.css("-ms-transform")||obj.css("-o-transform")||obj.css("transform");if(matrix!=='none'){var values=matrix.split('(')[1].split(')')[0].split(',');var a=values[0];var b=values[1];var angle=Math.round(Math.atan2(b,a)*(180/Math.PI));}else{var angle=0;}
return(angle<0)?angle+360:angle;}
$("#imageInput_img").click(function(){$("#imageInput").trigger('click');});function mouvementTexte(){$(".computer-text-inner").each(function(){let moveposxlogo=$(".text_center_top").offset().top;let moveposylogo=$(".text_center_left").offset().left;let moveposxlogos=$(".logos_center_top").offset().top;let moveposylogos=$(".logos_center_left").offset().left;let returnvaleury=moveposylogos-moveposylogo;if(returnvaleury<=20&&returnvaleury>=-20){$(".text_center_left").addClass("target-y");$(".logos_center_left").addClass("target-y");}else{$(".text_center_left").removeClass("target-y");$(".logos_center_left").removeClass("target-y");}
let returnvaleurx=moveposxlogos-moveposxlogo;if(returnvaleurx<=20&&returnvaleurx>=-20){$(".text_center_top").addClass("target-x");$(".logos_center_top").addClass("target-x");}else{$(".text_center_top").removeClass("target-x");$(".logos_center_top").removeClass("target-x");}});}});